package md2k.mCerebrum.cStress.tests;

import md2k.mCerebrum.cStress.Autosense.AUTOSENSE;
import md2k.mCerebrum.cStress.Autosense.SensorConfiguration;
import md2k.mCerebrum.cStress.Library.Core;
import md2k.mCerebrum.cStress.Structs.DataPoint;
import md2k.mCerebrum.cStress.Structs.Lomb;
import md2k.mCerebrum.cStress.Structs.PeakValley;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.util.ArrayList;

import static org.junit.Assert.*;

/**
 * Copyright (c) 2015, The University of Memphis, MD2K Center
 * - Timothy Hnat <twhnat@memphis.edu>
 * All rights reserved.
 * <p>
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * <p>
 * * Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 * <p>
 * * Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 * <p>
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
public class CoreTest {


    @Before
    public void setUp() throws Exception {

    }

    @After
    public void tearDown() throws Exception {

    }

    @Test
    public void testComputeEnergy() throws Exception {

    }

    @Test
    public void testNextPower2() throws Exception {
        assertTrue(Core.nextPower2(0)==0);
        assertTrue(Core.nextPower2(1) == 0);
        assertTrue(Core.nextPower2(20)==5);
        assertTrue(Core.nextPower2(255)==8);
        assertTrue(Core.nextPower2(1000) == 10);
    }

    @Test
    public void testMagnitude() throws Exception {
        DataPoint[] x = new DataPoint[5];
        DataPoint[] y = new DataPoint[5];
        DataPoint[] z = new DataPoint[5];
        for(int i=0; i<x.length; i++) {
            x[i] = new DataPoint(i,i);
            y[i] = new DataPoint(i*i,i);
            z[i] = new DataPoint(i*i*i,i);
        }
        double[] result = Core.magnitude(x, y, z);

        double[] correctResult = {0, 1.73205080756888, 9.16515138991168, 28.6181760425084, 66.0908465674332};
        assertArrayEquals(result,correctResult,1e-3);

        DataPoint[] input = new DataPoint[0];
        double[] emptyresult = {};
        result = Core.magnitude(input, y, z);
        assertArrayEquals(result, emptyresult,1e-9);
    }

    @Test
    public void testCrossing() throws Exception {
        DataPoint[] input = new DataPoint[10]; //{0,1,4,9,16,25,36,49,64,81}
        input[0] = new DataPoint(1,0);
        input[1] = new DataPoint(3,1);
        input[2] = new DataPoint(4,2);
        input[3] = new DataPoint(-1,3);
        input[4] = new DataPoint(-4,4);
        input[5] = new DataPoint(7,5);
        input[6] = new DataPoint(3,6);
        input[7] = new DataPoint(1,7);
        input[8] = new DataPoint(3,8);
        input[9] = new DataPoint(9,9);

        double mean = 2.0;

        double[] result = Core.crossing(input, mean);

        double[] correctResult = {1,3,5,7,8};
        assertArrayEquals(result, correctResult,1e-9);

        result = Core.crossing(input, -10);
        double[] emptyresult = {};
        assertArrayEquals(result, emptyresult,1e-9);

        input = new DataPoint[0];
        result = Core.crossing(input, mean);
        assertArrayEquals(result, emptyresult,1e-9);
    }

    @Test
    public void testDiff() throws Exception {
        DataPoint[] input = new DataPoint[10];
        for(int i=0; i<input.length; i++) {
            input[i] = new DataPoint(i*i,i);
        }

        double[] result = Core.diff(input);

        double[] correctResult = {1,3,5,7,9,11,13,15,17};
        assertArrayEquals(result, correctResult,1e-9);

        DataPoint[] zeroinput = new DataPoint[0];
        result = Core.diff(zeroinput);
        assertTrue(result.length == 0);
    }

    @Test
    public void testApplyFilterNormalize() throws Exception {
        double[] data = new double[]{
                0.2077, 0.3012, 0.4709, 0.2305, 0.8443, 0.1948, 0.2259, 0.1707, 0.2277, 0.4357,
                0.3111, 0.9234, 0.4302, 0.1848, 0.9049, 0.9797, 0.4389, 0.1111, 0.2581, 0.4087,
                0.5949, 0.2622, 0.6028, 0.7112, 0.2217, 0.1174, 0.2967, 0.3188, 0.4242, 0.5079,
                0.0855, 0.2625, 0.8010, 0.0292, 0.9289, 0.7303, 0.4886, 0.5785, 0.2373, 2.4588,
                2.9631, 2.5468, 2.5211, 2.2316, 2.4889, 2.6241, 2.6791, 2.3955, 2.3674, 2.9880,
                2.0377, 2.8852, 2.9133, 2.7962, 2.0987, 2.2619, 2.3354, 2.6797, 2.1366, 2.7212,
                0.1068, 0.6538, 0.4942, 0.7791, 0.7150, 0.9037, 0.8909, 0.3342, 0.6987, 0.1978,
                0.0305, 0.7441, 0.50, 0.4799, 0.9047, 0.6099, 0.6177, 0.8594, 0.8055, 0.5767,
                0.1829, 0.2399, 0.8865, 0.0287, 0.4899, 0.1679, 0.9787, 0.7127, 0.505, 0.4711,
                0.0596, 0.6820, 0.0424, 0.0714, 0.5216, 0.0967, 0.8181, 0.8175, 0.7224, 0.1499};

        double[] filter = new double[]{0,0,0,0,1,1,1,1,1,0,0,0,0};

        double[] correctResult = new double[]{
                0.0784, 0.0968, 0.1643, 0.1633, 0.1572, 0.1332, 0.1330, 0.103, 0.1096, 0.1654,
                0.1862, 0.1827, 0.2202, 0.2737, 0.2350, 0.2094, 0.2153, 0.1756, 0.1449, 0.1307,
                0.1701, 0.2063, 0.1913, 0.1532, 0.1559, 0.1332, 0.1102, 0.1331, 0.1306, 0.1278,
                0.1664, 0.1348, 0.1685, 0.220, 0.2381, 0.2203, 0.2370, 0.3593, 0.5378, 0.7024,
                0.8577, 1.0172, 1.0196, 0.9925, 1.031, 0.9930, 1.039, 1.0438, 0.9969, 1.0134,
                1.0548, 1.0891, 1.0180, 1.0359, 0.9919, 0.9733, 0.9205, 0.9703, 0.7980, 0.6635,
                0.4888, 0.3802, 0.2198, 0.2835, 0.3025, 0.2897, 0.2833, 0.2419, 0.1721, 0.1603,
                0.1736, 0.1561, 0.2126, 0.2590, 0.2489, 0.2776, 0.3036, 0.2774, 0.2433, 0.2131,
                0.2152, 0.1531, 0.1462, 0.1450, 0.2040, 0.1901, 0.2279, 0.2264, 0.2177, 0.1940,
                0.1404, 0.1061, 0.1101, 0.1131, 0.1240, 0.1859, 0.2380, 0.2083, 0.205, 0.1351};
            
        double[] result = Core.applyFilterNormalize(data, filter, 90);
        assertArrayEquals(correctResult,result,1e-1);
    }

    @Test
    public void testApplySquareFilterNormalize() throws Exception {
        double[] data = new double[]{
                0.2077, 0.3012, 0.4709, 0.2305, 0.8443, 0.1948, 0.2259, 0.1707, 0.2277, 0.4357,
                0.3111, 0.9234, 0.4302, 0.1848, 0.9049, 0.9797, 0.4389, 0.1111, 0.2581, 0.4087,
                0.5949, 0.2622, 0.6028, 0.7112, 0.2217, 0.1174, 0.2967, 0.3188, 0.4242, 0.5079,
                0.0855, 0.2625, 0.8010, 0.0292, 0.9289, 0.7303, 0.4886, 0.5785, 0.2373, 2.4588,
                2.9631, 2.5468, 2.5211, 2.2316, 2.4889, 2.6241, 2.6791, 2.3955, 2.3674, 2.9880,
                2.0377, 2.8852, 2.9133, 2.7962, 2.0987, 2.2619, 2.3354, 2.6797, 2.1366, 2.7212,
                0.1068, 0.6538, 0.4942, 0.7791, 0.7150, 0.9037, 0.8909, 0.3342, 0.6987, 0.1978,
                0.0305, 0.7441, 0.50, 0.4799, 0.9047, 0.6099, 0.6177, 0.8594, 0.8055, 0.5767,
                0.1829, 0.2399, 0.8865, 0.0287, 0.4899, 0.1679, 0.9787, 0.7127, 0.505, 0.4711,
                0.0596, 0.6820, 0.0424, 0.0714, 0.5216, 0.0967, 0.8181, 0.8175, 0.7224, 0.1499};

        double[] correctResult = new double[]{
                0.00671839822402745, 0.0141287156412916, 0.0345342580855585, 0.00827436374687981, 0.111016192404356,
                0.00590977102643782, 0.00794740254822651, 0.00453795089040273, 0.00807455897064222, 0.0295643182925625,
                0.015072759569749, 0.132792176709209, 0.0288226270032061, 0.0053185920882029, 0.127524587042103,
                0.149478580682623, 0.0300001834975195, 0.00192229867813768, 0.0103745378265731, 0.0260136938518274,
                0.0551163801967219, 0.0107067613899058, 0.0565899404214741, 0.0787727931961658, 0.00765462881019527,
                0.00214649036426415, 0.0137096965442768, 0.0158281214827087, 0.028024255109379, 0.040174379254036,
                0.00113847888125179, 0.0107312760044125, 0.0999212323367918, 0.000132787884588151, 0.134378774209238,
                0.0830606548383664, 0.0371791686716713, 0.052119408225055, 0.00876977045122196, 0.941540830734658,
                1.36736785625478, 1.01014200718464, 0.989857992815362, 0.775577952652726, 0.964734133839088,
                1.07239186766248, 1.11781671170584, 0.893686298877964, 0.8728428043484, 1.39044538733626,
                0.646655893977508, 1.2964166391813, 1.32179214633653, 1.21766889477871, 0.685951601608438,
                0.796782066334614, 0.849405954521372, 1.11831745085666, 0.71095022751843, 1.15322400528021,
                0.00177637746376519, 0.0665706169607485, 0.0380362971486958, 0.0945320678734937, 0.0796168210482471,
                0.127186587180873, 0.12360916345887, 0.0173942473095469, 0.0760281172707924, 0.00609319846412304,
                0.000144874659455488, 0.0862293988652798, 0.0389343347098866, 0.0358669336414763, 0.12746822258443,
                0.0579308653842302, 0.0594220940100737, 0.115022670937488, 0.101047096493598, 0.0517955742321656,
                0.00520978931116943, 0.00896299688226696, 0.122391210256235, 0.000128279288628746, 0.0373772743535422,
                0.00439029943419574, 0.14917358467824, 0.0791054247913263, 0.0397169148375553, 0.0345635990001959,
                0.000553203945532283, 0.0724371739904052, 0.000279978358272183, 0.000793942723910454,
                0.0423709220416298, 0.00145628272438133, 0.10423307129968, 0.104080236904837, 0.081273361744522,
                0.003499419561098};

        double[] result = Core.applySquareFilterNormalize(data, 90);
        assertArrayEquals(correctResult,result,1e-1);
    }

    @Test
    public void testBlackman() throws Exception {
        double[] trueBlackman10;
        double[] result;
        double sum;

        //Test window of length 10
        int windowLength = 10;
        trueBlackman10 = new double[]{ 0, 0.0509, 0.2580, 0.630, 0.9511, 0.9511, 0.630, 0.2580, 0.0509, 0};

        result = Core.blackman(windowLength);

        sum = 0.0;
        for(int i=0; i<result.length; i++) {
            sum += Math.abs(result[i]-trueBlackman10[i]);
        }
        assertEquals(sum,0.0,1e-3);

        //Test window of length 0
        windowLength = 0;
        result = Core.blackman(windowLength);
        assertArrayEquals(result,new double[0],1e-4);
    }

    @Test
    public void testFirls() throws Exception {
        //Currently has a hard-coded filter output
    }

    @Test
    public void testConv() throws Exception {
        double[] signal = {1,2,3,2,1};
        double[] kernel = {1,0,1};
        double[] trueAnswer = {2,4,4,4,2};

        double[] result = Core.conv(signal, kernel);

        assertArrayEquals(result,trueAnswer,1e-3);
    }


    @Test
    public void testSmooth() throws Exception {
        double[] inputdata = {1, 2, 3, 4, 5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5,
                -4, -3, -2, -1, 0, 3, 5, 3, 0, -3, -5, -3, 0};

        double[] correctResult = {1.0, 2.0, 3.0, 3.60, 3.80, 3.60, 3.0, 2.0, 1.0, 0.0, -1.0,
                -2.0, -3.0, -3.60, -3.80, -3.60, -3.0, -2.0, -0.60, 1.0, 2.0, 2.20, 1.60, 0, -1.60, -2.20, -2.6667, 0};

        DataPoint[] inputdp = new DataPoint[inputdata.length];
        for(int i = 0; i<inputdata.length; i++) {
            inputdp[i] = new DataPoint(inputdata[i],i);
        }

        DataPoint[] result = Core.smooth(inputdp, 5);
        double sum = 0.0;
        for(int i=0; i< result.length; i++) {
            sum += Math.abs(result[i].value-correctResult[i]);
        }
        assertTrue(sum < 1e-4);
    }

    @Test
    public void testWindow() throws Exception {

    }

    @Test
    public void testDetect_outlier_v2() throws Exception {
        double[] inputValue = new double[] {
                1.71875, 1.046875, 0.5625, 0.5625, 0.578125, 0.59375, 0.578125, 0.5625, 0.5625, 0.546875, 0.546875,
                0.546875, 0.5625, 0.5625, 0.578125, 0.625, 0.671875, 0.625, 0.71875, 0.65625, 0.65625, 0.53125,
                0.59375, 0.609375, 0.578125, 0.5625, 0.5625, 0.546875, 0.546875, 0.5625, 0.546875, 0.546875, 0.578125,
                0.5625, 0.578125, 0.578125, 0.578125, 0.578125, 0.5625, 0.5625, 0.546875, 0.5625, 0.5625, 0.578125,
                0.578125, 0.59375, 0.5625, 0.59375, 0.578125, 0.59375, 0.59375, 0.578125, 0.578125, 0.578125,
                0.578125, 0.578125, 0.578125, 0.578125, 0.578125, 1.71875, 0.5625, 0.546875, 0.5625, 0.625, 0.640625,
                0.640625, 0.671875, 0.671875, 0.640625, 0.625, 0.59375, 0.578125, 0.5625, 0.546875, 0.578125,
                0.609375, 0.6875, 0.671875, 0.6875, 0.75, 0.65625, 0.640625, 0.546875, 0.671875, 1.0625, 0.5625,
                0.5625, 0.5625, 0.5625, 0.578125, 0.578125, 0.609375, 0.640625, 0.6875, 0.640625, 0.609375, 0.578125,
                0.578125, 0.640625, 1.015625
        };

        long[] inputTimestamps = new long[100];
        for(int i=0; i<inputTimestamps.length; i++) {
            inputTimestamps[i] = i;
        }

        int[] correctResult = new int[]{
                0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0,
                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2
        };

        int[] result = Core.detect_outlier_v2(inputValue, inputTimestamps);

        assertArrayEquals(correctResult,result);
    }

    @Test
    public void testDetect_Rpeak() throws Exception {
        double frequency = 64.0;

        double[] inputValues = new double[] {
                2305, 2615, 1917, 1719, 1728, 1779, 1766, 1748, 1827, 1808, 1867, 1835, 1845, 1818, 1808, 1875, 1877,
                1809, 1879, 1840, 1885, 1848, 1853, 1916, 1904, 1918, 1890, 1906, 1845, 1856, 1839, 1875, 1820, 1806,
                2880, 1906, 1891, 1885, 1911, 1856, 1790, 1697, 1706, 1655, 1680, 1777, 1734, 1757, 1802, 1824, 1902,
                1870, 1921, 1826, 1888, 1822, 1849, 1846, 1900, 1920, 1876, 1815, 2709, 2381, 1872, 1687, 1697, 1783,
                1721, 1776, 1770, 1765, 1860, 1827, 1792, 1830, 1885, 1808, 1820, 1808, 1834, 1840, 1823, 1824, 1824,
                1869, 1862, 1857, 1874, 1872, 1822, 1807, 1885, 1850, 1904, 1914, 1910, 1792, 2703, 2528, 1792, 1763,
                1823, 1846, 1840, 1852, 1790, 1814, 1850, 1840, 1794, 1837, 1809, 1898, 1808,
                1809.17724867725, 1812.65608465608, 1818.35714285714, 1826.20105820106, 1836.10846560847,
                1848, 1878, 1877, 1903, 1856, 1895, 1885, 1820, 1876, 2992, 2285, 1692, 1651, 1696, 1648, 1674, 1719,
                1795, 1776, 1808, 1830, 1815, 1782, 1795, 1840, 1791, 1879, 1799, 1819, 1856, 1831, 1899, 1894, 1851,
                1872, 1895, 1933, 1864, 1928, 1920, 1946, 1906, 1725, 1797, 2096, 3075, 2246, 1755, 1658, 1744, 1681,
                1703, 1732, 1763, 1808, 1815, 1774, 1808, 1743, 1824, 1849, 1834, 1824, 1879, 1808, 1873, 1810, 1879,
                1847, 1808, 1898, 1893, 1849, 1821, 1840, 1840, 1910, 1897, 1834, 1824
        };

        DataPoint[] inputDatapoints = new DataPoint[inputValues.length];
        for(int i=0; i<inputValues.length; i++) {
            inputDatapoints[i] = new DataPoint(inputValues[i],i);
        }

        long[] correctResult = new long[]{2, 35, 63, 99, 130, 166}; //Verified for this signal through Matlab findpeaks

        long[] result = Core.detect_Rpeak(inputDatapoints, frequency);

        assertArrayEquals(correctResult,result);
    }

    @Test
    public void testRr_ave_update() throws Exception {

        int[] rawData = new int[] {3, 34, 64, 100, 130, 166, 202, 239, 277, 314, 350, 386, 421, 456};
        
        ArrayList<Integer> inputData = new ArrayList<Integer>();
        for(int i: rawData) {
            inputData.add(i);
        }

        double rr_value = 36.375;

        double correctResult = 36.25;

        double result = Core.rr_ave_update(inputData, rr_value);

        assertEquals(correctResult, result, 1e-9);
    }

    @Test
    public void testLomb() throws Exception {
        double[] inputdata = new double[]{
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.589800773477313, -0.753862625145271,
                -0.917924476813228, -0.917924476813228, -1.08198632848119, -1.08198632848119, -1.08198632848119,
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.261677070141398, 0.230508484862474,
                -0.261677070141398, 0.722694039866347, 0.0664466331945169, 0.0664466331945169, -1.24604818014914,
                -0.589800773477313, -0.425738921809356, -0.753862625145271, -0.917924476813228, -0.917924476813228,
                -1.08198632848119, -1.08198632848119, -0.917924476813228, -1.08198632848119, -1.08198632848119,
                -0.753862625145271, -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.917924476813228, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.589800773477313, -0.917924476813228,
                -0.589800773477313, -0.753862625145271, -0.589800773477313, -0.589800773477313, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.261677070141398, -0.0976152184734407, -0.0976152184734407, 0.230508484862474, 0.230508484862474,
                -0.0976152184734407, -0.261677070141398, -0.589800773477313, -0.753862625145271, -0.917924476813228,
                -1.08198632848119, -0.753862625145271, -0.425738921809356, 0.394570336530432, 0.230508484862474,
                0.394570336530432, 1.05081774320226, 0.0664466331945169, -0.0976152184734407, -1.08198632848119,
                0.230508484862474, 4.33205477656141, -0.917924476813228, -0.917924476813228, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.425738921809356, -0.0976152184734407,
                0.394570336530432, -0.0976152184734407, -0.425738921809356};

        DataPoint[] input = new DataPoint[inputdata.length];
        for(int i=0; i<input.length; i++) {
            input[i] = new DataPoint(inputdata[i],i+1);
        }

        Lomb result = Core.lomb(input);

        double[] correctResultP = new double[] {
                4.67921414136144, 4.9918173202647, 5.82786784021648, 5.63086219140335, 3.85843656513102,
                3.25177724990639, 2.74571579293217, 1.24010595520756, 0.126104480324749, 0.31854088965193,
                1.61384437636993, 2.32314673318736, 1.79114111736095, 0.81226822234912, 0.412459487127602,
                1.2357994941312, 2.38377588999756, 2.66772187257514, 1.57229344747761, 0.209501539515911,
                0.360120787556712, 2.45809323474862, 4.96214245158792, 5.5209523594057, 4.01914823613531,
                1.78549061486487, 0.547517383550135, 0.83356503645311, 1.55070110008783, 1.61818357297738,
                0.858548836516559, 0.152383833216177, 0.0359116563895136, 0.128192201699579, 0.0301443433090243,
                0.122614378340868, 0.991273688890313, 2.1752550164769, 2.55640544027612, 1.79371783214765,
                0.811483013815188, 0.879173994973389, 1.74313692641656, 2.31941846950287, 1.95082811049457,
                1.1901228989317, 0.785668669533728, 0.792934991911251, 0.964206575885427, 1.07510877449472,
                1.10559542184177, 0.942348203623467, 0.750512862844883, 0.809116854118117, 1.24402984968616,
                1.64913048666162, 1.49168802138273, 0.835115271493764, 0.243840468844885, 0.239109953831388,
                0.655424873061819, 0.920946316154778, 0.724736310035187, 0.337567411491088, 0.24377978778768,
                0.502578814607277, 0.796746131356234, 0.841102058028839, 0.74460209423957, 0.693262484147578,
                0.693274097258448, 0.740674417806035, 0.948356814463732, 1.39131139981509, 1.6556031735549,
                1.38495169346124, 0.775829923211945, 0.568523102936685, 1.04335785236737, 1.59144503258897,
                1.51838304128271, 0.929130383451798, 0.635354320914837, 0.988525381309064, 1.62498222250744,
                1.90332036343325, 1.73271727847712, 1.35984760778451, 1.04205442941426, 0.934515714784768,
                1.02096510871049, 1.21766546522226, 1.20228073473993, 0.852986889512837, 0.403786097131796,
                0.283095183705155, 0.586808784966944, 0.887128011975811, 0.77760396379931, 0.346839258649854,
                0.148317219843383, 0.460827513946637, 0.965270873457532, 1.09419071466221, 0.729270267558226,
                0.326546044321516, 0.302039953493521, 0.626885853423103, 0.88212652609271, 0.825450431231665,
                0.53380676099569, 0.277637081059907, 0.235886033261577, 0.383269250829952, 0.566844983767095,
                0.601255514597881, 0.460498960812623, 0.272825118910204, 0.270776828052624, 0.483953496437506,
                0.751873599846752, 0.859637159962459, 0.809939956181541, 0.72147482826175, 0.640762379014475,
                0.580115607599051, 0.527138081882833, 0.567045569147096, 0.649599929629271, 0.67535828560067,
                0.563051892142837, 0.426509955375219, 0.444202218631274, 0.62061386657057, 0.800872478371616,
                0.77618918582282, 0.591425250468233, 0.399748105098098, 0.396393780601866, 0.590448076991075,
                0.836207847946407, 0.944252994364163, 0.829988357666191, 0.693517159501687, 0.692322890432624,
                0.878586973475927, 0.984408903826885, 0.80342155622685, 0.469623895487054, 0.327574012792455,
                0.60372097063119, 0.991024903546646, 1.08812835189268, 0.733130956592615, 0.340437861822605,
                0.310671864145908, 0.608463471451749, 0.856421850178353, 0.74230311634726, 0.420804121965433,
                0.151673589289348, 0.181138173571597, 0.434363254069844, 0.687973625809582, 0.675747579786264,
                0.399611975331429, 0.138238122569294, 0.119232961729591, 0.318697971915615, 0.419682309304213,
                0.285849051349879, 0.0710438414749163, 0.134260843032924, 0.470081811162584, 0.783366102800891,
                0.680815755357774, 0.288768938291217, 0.0247809026203046, 0.0792887566553566, 0.337032773858422,
                0.41451115768105, 0.399459379483128, 0.385932427703259, 1.55802947559688, 0.38593242770324,
                0.399459379483129};

        double[] correctResultF = new double[] {
                0.00271739130434783, 0.00543478260869565, 0.00815217391304348, 0.0108695652173913, 0.0135869565217391,
                0.016304347826087, 0.0190217391304348, 0.0217391304347826, 0.0244565217391304, 0.0271739130434783,
                0.0298913043478261, 0.0326086956521739, 0.0353260869565217, 0.0380434782608696, 0.0407608695652174,
                0.0434782608695652, 0.046195652173913, 0.0489130434782609, 0.0516304347826087, 0.0543478260869565,
                0.0570652173913043, 0.0597826086956522, 0.0625, 0.0652173913043478, 0.0679347826086956,
                0.0706521739130435, 0.0733695652173913, 0.0760869565217391, 0.078804347826087, 0.0815217391304348,
                0.0842391304347826, 0.0869565217391304, 0.0896739130434783, 0.0923913043478261, 0.0951086956521739,
                0.0978260869565217, 0.10054347826087, 0.103260869565217, 0.105978260869565, 0.108695652173913,
                0.111413043478261, 0.114130434782609, 0.116847826086957, 0.119565217391304, 0.122282608695652,
                0.125, 0.127717391304348, 0.130434782608696, 0.133152173913043, 0.135869565217391, 0.138586956521739,
                0.141304347826087, 0.144021739130435, 0.146739130434783, 0.14945652173913, 0.152173913043478,
                0.154891304347826, 0.157608695652174, 0.160326086956522, 0.16304347826087, 0.165760869565217,
                0.168478260869565, 0.171195652173913, 0.173913043478261, 0.176630434782609, 0.179347826086957,
                0.182065217391304, 0.184782608695652, 0.1875, 0.190217391304348, 0.192934782608696, 0.195652173913043,
                0.198369565217391, 0.201086956521739, 0.203804347826087, 0.206521739130435, 0.209239130434783,
                0.21195652173913, 0.214673913043478, 0.217391304347826, 0.220108695652174, 0.222826086956522,
                0.22554347826087, 0.228260869565217, 0.230978260869565, 0.233695652173913, 0.236413043478261,
                0.239130434782609, 0.241847826086957, 0.244565217391304, 0.247282608695652, 0.25, 0.252717391304348,
                0.255434782608696, 0.258152173913043, 0.260869565217391, 0.263586956521739, 0.266304347826087,
                0.269021739130435, 0.271739130434783, 0.27445652173913, 0.277173913043478, 0.279891304347826,
                0.282608695652174, 0.285326086956522, 0.28804347826087, 0.290760869565217, 0.293478260869565,
                0.296195652173913, 0.298913043478261, 0.301630434782609, 0.304347826086957, 0.307065217391304,
                0.309782608695652, 0.3125, 0.315217391304348, 0.317934782608696, 0.320652173913043, 0.323369565217391,
                0.326086956521739, 0.328804347826087, 0.331521739130435, 0.334239130434783, 0.33695652173913,
                0.339673913043478, 0.342391304347826, 0.345108695652174, 0.347826086956522, 0.35054347826087,
                0.353260869565217, 0.355978260869565, 0.358695652173913, 0.361413043478261, 0.364130434782609,
                0.366847826086957, 0.369565217391304, 0.372282608695652, 0.375, 0.377717391304348, 0.380434782608696,
                0.383152173913043, 0.385869565217391, 0.388586956521739, 0.391304347826087, 0.394021739130435,
                0.396739130434783, 0.39945652173913, 0.402173913043478, 0.404891304347826, 0.407608695652174,
                0.410326086956522, 0.41304347826087, 0.415760869565217, 0.418478260869565, 0.421195652173913,
                0.423913043478261, 0.426630434782609, 0.429347826086957, 0.432065217391304, 0.434782608695652,
                0.4375, 0.440217391304348, 0.442934782608696, 0.445652173913043, 0.448369565217391, 0.451086956521739,
                0.453804347826087, 0.456521739130435, 0.459239130434783, 0.46195652173913, 0.464673913043478,
                0.467391304347826, 0.470108695652174, 0.472826086956522, 0.47554347826087, 0.478260869565217,
                0.480978260869565, 0.483695652173913, 0.486413043478261, 0.489130434782609, 0.491847826086957,
                0.494565217391304, 0.497282608695652, 0.5, 0.502717391304348, 0.505434782608696};


        assertArrayEquals(correctResultF,result.f,1e-4);

        assertArrayEquals(correctResultP,result.P,1e-4);


    }

    @Test
    public void testHeartRateLFHF() throws Exception {
        double[] inputdata = new double[]{
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.589800773477313, -0.753862625145271,
                -0.917924476813228, -0.917924476813228, -1.08198632848119, -1.08198632848119, -1.08198632848119,
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.261677070141398, 0.230508484862474,
                -0.261677070141398, 0.722694039866347, 0.0664466331945169, 0.0664466331945169, -1.24604818014914,
                -0.589800773477313, -0.425738921809356, -0.753862625145271, -0.917924476813228, -0.917924476813228,
                -1.08198632848119, -1.08198632848119, -0.917924476813228, -1.08198632848119, -1.08198632848119,
                -0.753862625145271, -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.917924476813228, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.589800773477313, -0.917924476813228,
                -0.589800773477313, -0.753862625145271, -0.589800773477313, -0.589800773477313, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.261677070141398, -0.0976152184734407, -0.0976152184734407, 0.230508484862474, 0.230508484862474,
                -0.0976152184734407, -0.261677070141398, -0.589800773477313, -0.753862625145271, -0.917924476813228,
                -1.08198632848119, -0.753862625145271, -0.425738921809356, 0.394570336530432, 0.230508484862474,
                0.394570336530432, 1.05081774320226, 0.0664466331945169, -0.0976152184734407, -1.08198632848119,
                0.230508484862474, 4.33205477656141, -0.917924476813228, -0.917924476813228, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.425738921809356, -0.0976152184734407,
                0.394570336530432, -0.0976152184734407, -0.425738921809356};

        DataPoint[] input = new DataPoint[inputdata.length];
        for(int i=0; i<input.length; i++) {
            input[i] = new DataPoint(inputdata[i],i+1);
        }

        Lomb result = Core.lomb(input);

        double resultLFHF = Core.heartRateLFHF(result.P, result.f, 0.09, 0.15);
        assertEquals(2.87724349469217, resultLFHF, 1e-8);


    }

    @Test
    public void testHeartRatePower() throws Exception {
        double[] inputdata = new double[]{
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.589800773477313, -0.753862625145271,
                -0.917924476813228, -0.917924476813228, -1.08198632848119, -1.08198632848119, -1.08198632848119,
                -0.917924476813228, -0.917924476813228, -0.753862625145271, -0.261677070141398, 0.230508484862474,
                -0.261677070141398, 0.722694039866347, 0.0664466331945169, 0.0664466331945169, -1.24604818014914,
                -0.589800773477313, -0.425738921809356, -0.753862625145271, -0.917924476813228, -0.917924476813228,
                -1.08198632848119, -1.08198632848119, -0.917924476813228, -1.08198632848119, -1.08198632848119,
                -0.753862625145271, -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.917924476813228, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.589800773477313, -0.917924476813228,
                -0.589800773477313, -0.753862625145271, -0.589800773477313, -0.589800773477313, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271, -0.753862625145271,
                -0.753862625145271, -0.753862625145271, -0.917924476813228, -1.08198632848119, -0.917924476813228,
                -0.261677070141398, -0.0976152184734407, -0.0976152184734407, 0.230508484862474, 0.230508484862474,
                -0.0976152184734407, -0.261677070141398, -0.589800773477313, -0.753862625145271, -0.917924476813228,
                -1.08198632848119, -0.753862625145271, -0.425738921809356, 0.394570336530432, 0.230508484862474,
                0.394570336530432, 1.05081774320226, 0.0664466331945169, -0.0976152184734407, -1.08198632848119,
                0.230508484862474, 4.33205477656141, -0.917924476813228, -0.917924476813228, -0.917924476813228,
                -0.917924476813228, -0.753862625145271, -0.753862625145271, -0.425738921809356, -0.0976152184734407,
                0.394570336530432, -0.0976152184734407, -0.425738921809356};

        DataPoint[] input = new DataPoint[inputdata.length];
        for(int i=0; i<input.length; i++) {
            input[i] = new DataPoint(inputdata[i],i+1);
        }

        Lomb result = Core.lomb(input);

        double result12 = Core.heartRatePower(result.P, result.f, 0.1, 0.2);
        assertEquals(38.1822734085174, result12, 1e-8);

        double result23 = Core.heartRatePower(result.P, result.f, 0.2, 0.3);
        assertEquals(35.0199378177408, result23, 1e-8);

        double result34 = Core.heartRatePower(result.P, result.f, 0.3, 0.4);
        assertEquals(22.3384393631384, result34, 1e-8);

    }

    @Test
    public void testPeakvalley_v2() throws Exception {

        double[] inputData = new double[] {
                2062, 2009, 1960, 1921, 1872, 1784, 1787, 1789, 1797, 1792, 1801, 1757, 1730, 1715, 1696, 1689, 1700, 
                1710, 1694, 1664, 1652, 1648, 1631, 1637, 1632, 1657, 1667, 1663, 1658, 1664, 1649, 1640, 1582, 1510, 
                1456, 1456, 1446, 1354, 1291, 1296, 1358, 1405, 1465, 1564, 1680, 1798, 1851, 1919, 2004, 2064, 2090, 
                2103, 2078, 2104, 2128, 2187, 2275, 2372, 2401, 2384, 2397, 2401, 2369, 2316, 2240, 2239, 2214, 2157, 
                2107, 2000, 1898, 1928, 1937, 1870, 1872, 1929, 1981, 2049, 2095, 2112, 2122, 2098, 2111, 2122, 2064,
                2019, 1954, 1902, 1865, 1840, 1855, 1894, 1966, 2091, 2192, 2314, 2409, 2455, 2469, 2464, 2494, 2509, 
                2558, 2613, 2656, 2719, 2726, 2699, 2636, 2544, 2434, 2312, 2178, 2066, 1968, 1926, 1871, 1821, 1772, 
                1728, 1721, 1714, 1699, 1695, 1696, 1750, 1773, 1799, 1825, 1824, 1837, 1868, 1908, 1955, 1984, 2054, 
                2132, 2227, 2342, 2464, 2596, 2741, 2875, 2982, 3056, 3139, 3179, 3214, 3227, 3216, 3168, 3062, 2950, 
                2835, 2720, 2649, 2547, 2419, 2258, 2128, 1980, 1845, 1736, 1651, 1600, 1556, 1549, 1547, 1530, 1488, 
                1445, 1417, 1389, 1393, 1392, 1386, 1371, 1386, 1463, 1552, 1683, 1742, 1749, 1757, 1792, 1883, 1994, 
                2107, 2228, 2352, 2478, 2577, 2685, 2775, 2832, 2861, 2854, 2835, 2851, 2864, 2850, 2817, 2758, 2712, 
                2624, 2545, 2445, 2346, 2229, 2128, 2026, 1910, 1794, 1663, 1520, 1489.32846145564, 1473.26218776916, 
                1464.44869186047, 1455.53548664944, 1439.17008505599, 1408, 1252, 1123, 1033, 1024, 1026.2668657738, 
                1032.69841492059, 1042.7410751785, 1055.84127428563, 1071.44543998009, 1089, 1121, 1150, 1192, 1200, 
                1249, 1301, 1359, 1421, 1456, 1522, 1562, 1615, 1660, 1728, 1820, 1900, 1991, 2073, 2160, 2282, 2399, 
                2494, 2585, 2640, 2699, 2740, 2759, 2788, 2800, 2508, 2437, 2369, 2305, 2224, 2157, 2065, 1991, 1888, 
                1808, 1717, 1629, 1531, 1466, 1408, 1379, 1343, 1317, 1256, 1216, 1210, 1241, 1279, 1332, 1360, 1407, 
                1436, 1459, 1496, 1520, 1585, 1629, 1677, 1692, 1744, 1792, 1834, 1901, 1997, 2096, 2197, 2280, 2352,
                2442, 2512, 2590, 2639, 2693, 2723, 2752, 2800, 2835, 2846, 2823, 2752, 2690, 2618, 2550, 2454, 2352, 
                2255, 2138, 1991, 1853, 1712, 1629, 1540, 1463, 1368, 1296, 1249, 1208, 1195, 1192, 1200, 1221, 1220, 
                1255, 1299, 1344, 1432, 1506, 1585, 1662, 1696, 1729, 1763, 1796, 1841, 1904, 1992, 2081, 2194, 2294,
                2384, 2492, 2573, 2643, 2739, 2816, 2896, 2958, 2991, 2998, 2992, 2990, 2959, 2954, 2914, 2864, 2797,
                2725, 2630, 2514, 2368, 2212, 2046, 1908, 1785, 1648, 1553, 1448, 1367, 1335, 1328, 1381, 1438, 1510, 
                1570, 1632, 1697, 1750, 1791, 1861, 1920, 2012, 2049, 2072, 2068, 2064, 2069, 2085, 2082, 2085, 2080, 
                2123, 2173, 2225, 2322, 2400, 2495, 2593, 2690, 2779, 2848, 2928, 2975, 3024, 3049, 3072, 3092, 3062, 
                3049, 3012, 2928, 2830, 2699, 2583, 2452, 2336, 2200, 2052, 1893, 1769, 1648, 1529, 1429, 1362, 1303, 
                1264, 1267, 1283, 1289, 1306, 1328, 1399, 1435, 1467, 1482, 1488, 1522, 1563, 1590, 1630, 1696, 1777, 
                1876, 1979, 2068, 2144, 2261, 2359, 2461, 2547, 2624, 2708, 2784, 2843, 2876, 2880, 2894, 2886, 2859, 
                2820, 2784, 2760, 2723, 2683, 2645, 2592, 2535, 2496, 2436, 2388, 2320, 2264, 2223, 2176, 2136, 2080, 
                2039, 1991, 1939, 1879, 1808, 1772, 1724, 1700, 1672, 1664, 1644, 1625, 1582, 1545, 1504, 1513, 1487, 
                1447, 1406, 1360, 1317, 1288, 1271, 1272, 1280, 1314, 1341, 1381, 1408, 1424, 1476, 1519, 1540, 1587, 
                1632, 1685, 1708, 1734, 1746, 1760, 1805, 1848, 1892, 1965, 2032, 2125, 2226, 2323, 2420, 2512, 2622, 
                2716, 2803, 2854, 2880, 2916, 2950, 2976, 2979, 2976, 3012, 3037, 3050, 3066, 3072, 3079, 3056, 3030, 
                3001, 2960, 2939, 2914, 2873, 2852, 2800, 2772, 2697, 2623, 2516, 2384, 2232, 2086, 1934, 1767, 1616, 
                1529, 1439, 1391, 1366, 1360, 1383, 1380, 1368, 1359, 1360, 1361.17238867507, 1362.35840704524, 
                1363.89611623667, 1366.12357737551, 1369.3788515879, 1374, 1403, 1451, 1490, 1520, 1540, 1568, 1609, 
                1654, 1664, 1688, 1687, 1689, 1711, 1712, 1762, 1805, 1830, 1844, 1872, 1915, 1924, 1923, 1943, 1968, 
                1982, 1997, 2025, 2038, 2080, 2132, 2162, 2195, 2229, 2256, 2263, 2286, 2293, 2314, 2304, 2323, 2325, 
                2325, 2307, 2272, 2250, 2226, 2183, 2145, 2080, 2013, 1939, 1907, 1876, 1840, 1832, 1845, 1859, 1865, 
                1840, 1835, 1826, 1807, 1802, 1792, 1804, 1811, 1810, 1828, 1840, 1852.14128310155, 1863.75110784182, 
                1875.8356830613, 1889.40121760049, 1905.45392029989, 1925, 1957, 1987, 2036, 2048, 2060, 2063, 2068, 
                2062, 2064, 2066, 2092, 2104, 2136, 2144, 2193, 2218, 2243, 2313, 2368, 2414, 2462, 2516, 2562, 2592, 
                2607, 2623, 2635, 2627, 2608, 2612, 2596, 2558, 2493, 2432, 2361, 2280, 2189, 2099, 2000, 1910, 1821, 
                1722, 1648, 1552, 1456, 1353, 1269, 1181, 1120, 1086, 1072, 1075, 1098, 1152, 1231, 1278, 1303, 1340, 
                1376, 1380, 1382, 1380, 1380, 1392, 1434, 1466, 1507, 1558, 1584, 2154, 2263, 2363, 2465, 2576, 2676, 
                2728, 2802, 2854, 2896, 2910.40504018009, 2919.93189016569, 2926.61768054865, 2932.49954192079, 
                2939.61460487396, 2950, 2967, 2978, 2960, 2944, 2959, 2983, 3010, 3061, 3104, 3180, 3235, 3257, 3267, 
                3280, 3297, 3323, 3352, 3399, 3456, 3531, 3595, 3648, 3680, 3696, 3743, 3783, 3799, 3824, 3808, 3759, 
                3650, 3519, 3347, 3168, 2962, 2789, 2605, 2441, 2272, 2155, 2034, 1955, 1892, 1840, 1797, 1780, 1747, 
                1714, 1664, 1634, 1602, 1605, 1576, 1520, 1501, 1484, 1450, 1426, 1408, 1374, 1322, 1267, 1207, 1168, 
                1178, 1186, 1187, 1189, 1184, 1233, 1254, 1246, 1218, 1184, 1215, 1217, 1216, 1216, 1184, 1168, 1156, 
                1138, 1114, 1104, 1073, 1013, 950, 903, 848, 823, 788, 782, 785, 800, 857, 910, 962, 1050, 1120, 1198,
                1252, 1316, 1370, 1424, 1477, 1531, 1577, 1617, 1632, 1690, 1723, 1747, 1777, 1792, 1798, 1803, 1804, 
                1816, 1808, 1825, 1812, 1800, 1789, 1792, 1833, 1838, 1854, 1863, 1840, 1875, 1886, 1875, 1874, 1888, 
                1900, 1918, 1948, 2000, 2016, 2045, 2041, 2002, 1959, 1936, 1916, 1907, 1912, 1903, 1888, 1926, 1957, 
                2046, 2113, 2192, 2300, 2401, 2464, 2518, 2560, 2583, 2579, 2561, 2513, 2464, 2435, 2411, 2400, 2421, 
                2448, 2695, 2698, 2688, 2665, 2624, 2596, 2575, 2543, 2475, 2416, 2341, 2269, 2192, 2114, 2032, 1940, 
                1829, 1736, 1627, 1552, 1474, 1405, 1335, 1312, 1296, 1313, 1331, 1357, 1368, 1408, 1422.96159326075, 
                1431.7816553758, 1437.67785672619, 1443.86786769299, 1453.56935865724, 1470, 1526, 1604, 1694, 1760, 
                1847, 1964, 2083, 2187, 2272, 2383, 2478, 2577, 2661, 2720, 2811, 2878, 2919, 2938, 2928, 2935, 2927, 
                2926, 2916, 2880, 2859, 2788, 2753, 2692, 2656, 2590, 2533, 2475, 2418, 2368, 2328, 2303, 2263, 2205, 
                2176, 2141, 2140, 2099, 2088, 2096
        };

        double[] inputTimestamp = new double[] {
                1389899835824250L, 1389899835871120L, 1389899835918000L, 1389899835964880L, 1389899836011750L,
                1389899836058620L, 1389899836105500L, 1389899836152380L, 1389899836199250L, 1389899836246120L,
                1389899836293000L, 1389899836339880L, 1389899836386750L, 1389899836433620L, 1389899836480500L,
                1389899836527380L, 1389899836574250L, 1389899836621120L, 1389899836668000L, 1389899836714880L,
                1389899836761750L, 1389899836808620L, 1389899836855500L, 1389899836902380L, 1389899836949250L,
                1389899836996120L, 1389899837043000L, 1389899837089880L, 1389899837136750L, 1389899837183620L,
                1389899837230500L, 1389899837277380L, 1389899837324250L, 1389899837371120L, 1389899837418000L,
                1389899837464880L, 1389899837511750L, 1389899837558620L, 1389899837605500L, 1389899837652380L,
                1389899837699250L, 1389899837746120L, 1389899837793000L, 1389899837839880L, 1389899837886750L,
                1389899837933620L, 1389899837980500L, 1389899838027380L, 1389899838074250L, 1389899838121120L,
                1389899838168000L, 1389899838214880L, 1389899838261750L, 1389899838308620L, 1389899838355500L,
                1389899838402380L, 1389899838449250L, 1389899838496120L, 1389899838543000L, 1389899838589880L,
                1389899838636750L, 1389899838683620L, 1389899838730500L, 1389899838777380L, 1389899838824250L,
                1389899838871120L, 1389899838918000L, 1389899838964880L, 1389899839011750L, 1389899839058620L,
                1389899839105500L, 1389899839152380L, 1389899839199250L, 1389899839246120L, 1389899839293000L,
                1389899839339880L, 1389899839386750L, 1389899839433620L, 1389899839480500L, 1389899839527380L,
                1389899839574250L, 1389899839621120L, 1389899839668000L, 1389899839714880L, 1389899839761750L,
                1389899839808620L, 1389899839855500L, 1389899839902380L, 1389899839949250L, 1389899839996120L,
                1389899840043000L, 1389899840089880L, 1389899840136750L, 1389899840183620L, 1389899840230500L,
                1389899840277380L, 1389899840324250L, 1389899840371120L, 1389899840418000L, 1389899840464880L,
                1389899840511750L, 1389899840558620L, 1389899840605500L, 1389899840652380L, 1389899840699250L,
                1389899840746120L, 1389899840793000L, 1389899840839880L, 1389899840886750L, 1389899840933620L,
                1389899840980500L, 1389899841027380L, 1389899841074250L, 1389899841121120L, 1389899841168000L,
                1389899841214880L, 1389899841261750L, 1389899841308620L, 1389899841355500L, 1389899841402380L,
                1389899841449250L, 1389899841496120L, 1389899841543000L, 1389899841589880L, 1389899841636750L,
                1389899841683620L, 1389899841730500L, 1389899841777380L, 1389899841824250L, 1389899841871120L,
                1389899841918000L, 1389899841964880L, 1389899842011750L, 1389899842058620L, 1389899842105500L,
                1389899842152380L, 1389899842199250L, 1389899842246120L, 1389899842293000L, 1389899842339880L,
                1389899842386750L, 1389899842433620L, 1389899842480500L, 1389899842527380L, 1389899842574250L,
                1389899842621120L, 1389899842668000L, 1389899842714880L, 1389899842761750L, 1389899842808620L,
                1389899842855500L, 1389899842902380L, 1389899842949250L, 1389899842996120L, 1389899843043000L,
                1389899843089880L, 1389899843136750L, 1389899843183620L, 1389899843230500L, 1389899843277380L,
                1389899843324250L, 1389899843371120L, 1389899843418000L, 1389899843464880L, 1389899843511750L,
                1389899843558620L, 1389899843605500L, 1389899843652380L, 1389899843699250L, 1389899843746120L,
                1389899843793000L, 1389899843839880L, 1389899843886750L, 1389899843933620L, 1389899843980500L,
                1389899844027380L, 1389899844074250L, 1389899844121120L, 1389899844168000L, 1389899844214880L,
                1389899844261750L, 1389899844308620L, 1389899844355500L, 1389899844402380L, 1389899844449250L,
                1389899844496120L, 1389899844543000L, 1389899844589880L, 1389899844636750L, 1389899844683620L,
                1389899844730500L, 1389899844777380L, 1389899844824250L, 1389899844871120L, 1389899844918000L,
                1389899844964880L, 1389899845011750L, 1389899845058620L, 1389899845105500L, 1389899845152380L,
                1389899845199250L, 1389899845246120L, 1389899845293000L, 1389899845339880L, 1389899845386750L,
                1389899845433620L, 1389899845480500L, 1389899845527380L, 1389899845574250L, 1389899845621120L,
                1389899845668000L, 1389899845714880L, 1389899845761750L, 1389899845808620L, 1389899845855500L,
                1389899845902380L, 1389899845949250L, 1389899845996120L, 1389899846043000L, 1389899846089880L,
                1389899846136750L, 1389899846183620L, 1389899846230500L, 1389899846277380L, 1389899846324250L,
                1389899846371120L, 1389899846418000L, 1389899846464880L, 1389899846511750L, 1389899846558620L,
                1389899846605500L, 1389899846652380L, 1389899846699250L, 1389899846746120L, 1389899846793000L,
                1389899846839880L, 1389899846886750L, 1389899846933620L, 1389899846980500L, 1389899847027380L,
                1389899847074250L, 1389899847121120L, 1389899847168000L, 1389899847214880L, 1389899847261750L,
                1389899847308620L, 1389899847355500L, 1389899847402380L, 1389899847449250L, 1389899847496120L,
                1389899847543000L, 1389899847589880L, 1389899847636750L, 1389899847683620L, 1389899847730500L,
                1389899847777380L, 1389899847824250L, 1389899847871120L, 1389899847918000L, 1389899847964880L,
                1389899848011750L, 1389899848058620L, 1389899848105500L, 1389899848152380L, 1389899848199250L,
                1389899848246120L, 1389899848293000L, 1389899848339880L, 1389899848386750L, 1389899848433620L,
                1389899848480500L, 1389899848527380L, 1389899848574250L, 1389899848621120L, 1389899848668000L,
                1389899848714880L, 1389899848761750L, 1389899848808620L, 1389899848855500L, 1389899848902380L,
                1389899848949250L, 1389899848996120L, 1389899849043000L, 1389899849089880L, 1389899849136750L,
                1389899849183620L, 1389899849230500L, 1389899849277380L, 1389899849324250L, 1389899849371120L,
                1389899849418000L, 1389899849464880L, 1389899849511750L, 1389899849558620L, 1389899849605500L,
                1389899849652380L, 1389899849699250L, 1389899849746120L, 1389899849793000L, 1389899849839880L,
                1389899849886750L, 1389899849933620L, 1389899849980500L, 1389899850027380L, 1389899850074250L,
                1389899850121120L, 1389899850168000L, 1389899850214880L, 1389899850261750L, 1389899850308620L,
                1389899850355500L, 1389899850402380L, 1389899850449250L, 1389899850496120L, 1389899850543000L,
                1389899850589880L, 1389899850636750L, 1389899850683620L, 1389899850730500L, 1389899850777380L,
                1389899850824250L, 1389899850871120L, 1389899850918000L, 1389899850964880L, 1389899851011750L,
                1389899851058620L, 1389899851105500L, 1389899851152380L, 1389899851199250L, 1389899851246120L,
                1389899851293000L, 1389899851339880L, 1389899851386750L, 1389899851433620L, 1389899851480500L,
                1389899851527380L, 1389899851574250L, 1389899851621120L, 1389899851668000L, 1389899851714880L,
                1389899851761750L, 1389899851808620L, 1389899851855500L, 1389899851902380L, 1389899851949250L,
                1389899851996120L, 1389899852043000L, 1389899852089880L, 1389899852136750L, 1389899852183620L,
                1389899852230500L, 1389899852277380L, 1389899852324250L, 1389899852371120L, 1389899852418000L,
                1389899852464880L, 1389899852511750L, 1389899852558620L, 1389899852605500L, 1389899852652380L,
                1389899852699250L, 1389899852746120L, 1389899852793000L, 1389899852839880L, 1389899852886750L,
                1389899852933620L, 1389899852980500L, 1389899853027380L, 1389899853074250L, 1389899853121120L,
                1389899853168000L, 1389899853214880L, 1389899853261750L, 1389899853308620L, 1389899853355500L,
                1389899853402380L, 1389899853449250L, 1389899853496120L, 1389899853543000L, 1389899853589880L,
                1389899853636750L, 1389899853683620L, 1389899853730500L, 1389899853777380L, 1389899853824250L,
                1389899853871120L, 1389899853918000L, 1389899853964880L, 1389899854011750L, 1389899854058620L,
                1389899854105500L, 1389899854152380L, 1389899854199250L, 1389899854246120L, 1389899854293000L,
                1389899854339880L, 1389899854386750L, 1389899854433620L, 1389899854480500L, 1389899854527380L,
                1389899854574250L, 1389899854621120L, 1389899854668000L, 1389899854714880L, 1389899854761750L,
                1389899854808620L, 1389899854855500L, 1389899854902380L, 1389899854949250L, 1389899854996120L,
                1389899855043000L, 1389899855089880L, 1389899855136750L, 1389899855183620L, 1389899855230500L,
                1389899855277380L, 1389899855324250L, 1389899855371120L, 1389899855418000L, 1389899855464880L,
                1389899855511750L, 1389899855558620L, 1389899855605500L, 1389899855652380L, 1389899855699250L,
                1389899855746120L, 1389899855793000L, 1389899855839880L, 1389899855886750L, 1389899855933620L,
                1389899855980500L, 1389899856027380L, 1389899856074250L, 1389899856121120L, 1389899856168000L,
                1389899856214880L, 1389899856261750L, 1389899856308620L, 1389899856355500L, 1389899856402380L,
                1389899856449250L, 1389899856496120L, 1389899856543000L, 1389899856589880L, 1389899856636750L,
                1389899856683620L, 1389899856730500L, 1389899856777380L, 1389899856824250L, 1389899856871120L,
                1389899856918000L, 1389899856964880L, 1389899857011750L, 1389899857058620L, 1389899857105500L,
                1389899857152380L, 1389899857199250L, 1389899857246120L, 1389899857293000L, 1389899857339880L,
                1389899857386750L, 1389899857433620L, 1389899857480500L, 1389899857527380L, 1389899857574250L,
                1389899857621120L, 1389899857668000L, 1389899857714880L, 1389899857761750L, 1389899857808620L,
                1389899857855500L, 1389899857902380L, 1389899857949250L, 1389899857996120L, 1389899858043000L,
                1389899858089880L, 1389899858136750L, 1389899858183620L, 1389899858230500L, 1389899858277380L,
                1389899858324250L, 1389899858371120L, 1389899858418000L, 1389899858464880L, 1389899858511750L,
                1389899858558620L, 1389899858605500L, 1389899858652380L, 1389899858699250L, 1389899858746120L,
                1389899858793000L, 1389899858839880L, 1389899858886750L, 1389899858933620L, 1389899858980500L,
                1389899859027380L, 1389899859074250L, 1389899859121120L, 1389899859168000L, 1389899859214880L,
                1389899859261750L, 1389899859308620L, 1389899859355500L, 1389899859402380L, 1389899859449250L,
                1389899859496120L, 1389899859543000L, 1389899859589880L, 1389899859636750L, 1389899859683620L,
                1389899859730500L, 1389899859777380L, 1389899859824250L, 1389899859871120L, 1389899859918000L,
                1389899859964880L, 1389899860011750L, 1389899860058620L, 1389899860105500L, 1389899860152380L,
                1389899860199250L, 1389899860246120L, 1389899860293000L, 1389899860339880L, 1389899860386750L,
                1389899860433620L, 1389899860480500L, 1389899860527380L, 1389899860574250L, 1389899860621120L,
                1389899860668000L, 1389899860714880L, 1389899860761750L, 1389899860808620L, 1389899860855500L,
                1389899860902380L, 1389899860949250L, 1389899860996120L, 1389899861043000L, 1389899861089880L,
                1389899861136750L, 1389899861183620L, 1389899861230500L, 1389899861277380L, 1389899861324250L,
                1389899861371120L, 1389899861418000L, 1389899861464880L, 1389899861511750L, 1389899861558620L,
                1389899861605500L, 1389899861652380L, 1389899861699250L, 1389899861746120L, 1389899861793000L,
                1389899861839880L, 1389899861886750L, 1389899861933620L, 1389899861980500L, 1389899862027380L,
                1389899862074250L, 1389899862121120L, 1389899862168000L, 1389899862214880L, 1389899862261750L,
                1389899862308620L, 1389899862355500L, 1389899862402380L, 1389899862449250L, 1389899862496120L,
                1389899862543000L, 1389899862589880L, 1389899862636750L, 1389899862683620L, 1389899862730500L,
                1389899862777380L, 1389899862824250L, 1389899862871120L, 1389899862918000L, 1389899862964880L,
                1389899863011750L, 1389899863058620L, 1389899863105500L, 1389899863152380L, 1389899863199250L,
                1389899863246120L, 1389899863293000L, 1389899863339880L, 1389899863386750L, 1389899863433620L,
                1389899863480500L, 1389899863527380L, 1389899863574250L, 1389899863621120L, 1389899863668000L,
                1389899863714880L, 1389899863761750L, 1389899863808620L, 1389899863855500L, 1389899863902380L,
                1389899863949250L, 1389899863996120L, 1389899864043000L, 1389899864089880L, 1389899864136750L,
                1389899864183620L, 1389899864230500L, 1389899864277380L, 1389899864324250L, 1389899864371120L,
                1389899864418000L, 1389899864464880L, 1389899864511750L, 1389899864558620L, 1389899864605500L,
                1389899864652380L, 1389899864699250L, 1389899864746120L, 1389899864793000L, 1389899864839880L,
                1389899864886750L, 1389899864933620L, 1389899864980500L, 1389899865027380L, 1389899865074250L,
                1389899865121120L, 1389899865168000L, 1389899865214880L, 1389899865261750L, 1389899865308620L,
                1389899865355500L, 1389899865402380L, 1389899865449250L, 1389899865496120L, 1389899865543000L,
                1389899865589880L, 1389899865636750L, 1389899865683620L, 1389899865730500L, 1389899865777380L,
                1389899865824250L, 1389899865871120L, 1389899865918000L, 1389899865964880L, 1389899866011750L,
                1389899866058620L, 1389899866105500L, 1389899866152380L, 1389899866199250L, 1389899866246120L,
                1389899866293000L, 1389899866339880L, 1389899866386750L, 1389899866433620L, 1389899866480500L,
                1389899866527380L, 1389899866574250L, 1389899866621120L, 1389899866668000L, 1389899866714880L,
                1389899866761750L, 1389899866808620L, 1389899866855500L, 1389899866902380L, 1389899866949250L,
                1389899866996120L, 1389899867043000L, 1389899867089880L, 1389899867136750L, 1389899867183620L,
                1389899867230500L, 1389899867277380L, 1389899867324250L, 1389899867371120L, 1389899867418000L,
                1389899867464880L, 1389899867511750L, 1389899867558620L, 1389899867605500L, 1389899867652380L,
                1389899867699250L, 1389899867746120L, 1389899867793000L, 1389899867839880L, 1389899867886750L,
                1389899867933620L, 1389899867980500L, 1389899868027380L, 1389899868074250L, 1389899868121120L,
                1389899868168000L, 1389899868214880L, 1389899868261750L, 1389899868308620L, 1389899868355500L,
                1389899868402380L, 1389899868449250L, 1389899868496120L, 1389899868543000L, 1389899868589880L,
                1389899868636750L, 1389899868683620L, 1389899868730500L, 1389899868777380L, 1389899868824250L,
                1389899868871120L, 1389899868918000L, 1389899868964880L, 1389899869011750L, 1389899869058620L,
                1389899869105500L, 1389899869152380L, 1389899869199250L, 1389899869246120L, 1389899869293000L,
                1389899869339880L, 1389899869386750L, 1389899869433620L, 1389899869480500L, 1389899869527380L,
                1389899869574250L, 1389899869621120L, 1389899869668000L, 1389899869714880L, 1389899869761750L,
                1389899869808620L, 1389899869855500L, 1389899869902380L, 1389899869949250L, 1389899869996120L,
                1389899870043000L, 1389899870089880L, 1389899870136750L, 1389899870183620L, 1389899870230500L,
                1389899870277380L, 1389899870324250L, 1389899870371120L, 1389899870418000L, 1389899870464880L,
                1389899870511750L, 1389899870558620L, 1389899870605500L, 1389899870652380L, 1389899870699250L,
                1389899870746120L, 1389899870793000L, 1389899870839880L, 1389899870886750L, 1389899870933620L,
                1389899870980500L, 1389899871027380L, 1389899871074250L, 1389899871121120L, 1389899871168000L,
                1389899871214880L, 1389899871261750L, 1389899871308620L, 1389899871355500L, 1389899871402380L,
                1389899871449250L, 1389899871496120L, 1389899871543000L, 1389899871589880L, 1389899871636750L,
                1389899871683620L, 1389899871730500L, 1389899871777380L, 1389899871824250L, 1389899871871120L,
                1389899871918000L, 1389899871964880L, 1389899872011750L, 1389899872058620L, 1389899872105500L,
                1389899872152380L, 1389899872199250L, 1389899872246120L, 1389899872293000L, 1389899872339880L,
                1389899872386750L, 1389899872433620L, 1389899872480500L, 1389899872527380L, 1389899872574250L,
                1389899872621120L, 1389899872668000L, 1389899872714880L, 1389899872761750L, 1389899872808620L,
                1389899872855500L, 1389899872902380L, 1389899872949250L, 1389899872996120L, 1389899873043000L,
                1389899873089880L, 1389899873136750L, 1389899873183620L, 1389899873230500L, 1389899873277380L,
                1389899873324250L, 1389899873371120L, 1389899873418000L, 1389899873464880L, 1389899873511750L,
                1389899873558620L, 1389899873605500L, 1389899873652380L, 1389899873699250L, 1389899873746120L,
                1389899873793000L, 1389899873839880L, 1389899873886750L, 1389899873933620L, 1389899873980500L,
                1389899874027380L, 1389899874074250L, 1389899874121120L, 1389899874168000L, 1389899874214880L,
                1389899874261750L, 1389899874308620L, 1389899874355500L, 1389899874402380L, 1389899874449250L,
                1389899874496120L, 1389899874543000L, 1389899874589880L, 1389899874636750L, 1389899874683620L,
                1389899874730500L, 1389899874777380L, 1389899874824250L, 1389899874871120L, 1389899874918000L,
                1389899874964880L, 1389899875011750L, 1389899875058620L, 1389899875105500L, 1389899875152380L,
                1389899875199250L, 1389899875246120L, 1389899875293000L, 1389899875339880L, 1389899875386750L,
                1389899875433620L, 1389899875480500L, 1389899875527380L, 1389899875574250L, 1389899875621120L,
                1389899875668000L, 1389899875714880L, 1389899875761750L, 1389899875808620L, 1389899875855500L,
                1389899875902380L, 1389899875949250L, 1389899875996120L, 1389899876043000L, 1389899876089880L,
                1389899876136750L, 1389899876183620L, 1389899876230500L, 1389899876277380L, 1389899876324250L,
                1389899876371120L, 1389899876418000L, 1389899876464880L, 1389899876511750L, 1389899876558620L,
                1389899876605500L, 1389899876652380L, 1389899876699250L, 1389899876746120L, 1389899876793000L,
                1389899876839880L, 1389899876886750L, 1389899876933620L, 1389899876980500L, 1389899877027380L,
                1389899877074250L, 1389899877121120L, 1389899877168000L, 1389899877214880L, 1389899877261750L,
                1389899877308620L, 1389899877355500L, 1389899877402380L, 1389899877449250L, 1389899877496120L,
                1389899877543000L, 1389899877589880L, 1389899877636750L, 1389899877683620L, 1389899877730500L,
                1389899877777380L, 1389899877824250L, 1389899877871120L, 1389899877918000L, 1389899877964880L,
                1389899878011750L, 1389899878058620L, 1389899878105500L, 1389899878152380L, 1389899878199250L,
                1389899878246120L, 1389899878293000L, 1389899878339880L, 1389899878386750L, 1389899878433620L,
                1389899878480500L, 1389899878527380L, 1389899878574250L, 1389899878621120L, 1389899878668000L,
                1389899878714880L, 1389899878761750L, 1389899878808620L, 1389899878855500L, 1389899878902380L,
                1389899878949250L, 1389899878996120L, 1389899879043000L, 1389899879089880L, 1389899879136750L,
                1389899879183620L, 1389899879230500L, 1389899879277380L, 1389899879324250L, 1389899879371120L,
                1389899879418000L, 1389899879464880L, 1389899879511750L, 1389899879558620L, 1389899879605500L,
                1389899879652380L, 1389899879699250L, 1389899879746120L, 1389899879793000L, 1389899879839880L,
                1389899879886750L, 1389899879933620L, 1389899879980500L, 1389899880027380L, 1389899880074250L,
                1389899880121120L, 1389899880168000L, 1389899880214880L, 1389899880261750L, 1389899880308620L,
                1389899880355500L, 1389899880402380L, 1389899880449250L, 1389899880496120L, 1389899880543000L,
                1389899880589880L, 1389899880636750L, 1389899880683620L, 1389899880730500L, 1389899880777380L,
                1389899880824250L, 1389899880871120L, 1389899880918000L, 1389899880964880L, 1389899881011750L,
                1389899881058620L, 1389899881105500L, 1389899881152380L, 1389899881199250L, 1389899881246120L,
                1389899881293000L, 1389899881339880L, 1389899881386750L, 1389899881433620L, 1389899881480500L,
                1389899881527380L, 1389899881574250L, 1389899881621120L, 1389899881668000L, 1389899881714880L,
                1389899881761750L, 1389899881808620L, 1389899881855500L, 1389899881902380L, 1389899881949250L,
                1389899881996120L, 1389899882043000L, 1389899882089880L, 1389899882136750L, 1389899882183620L,
                1389899882230500L, 1389899882277380L, 1389899882324250L, 1389899882371120L, 1389899882418000L,
                1389899882464880L, 1389899882511750L, 1389899882558620L, 1389899882605500L, 1389899882652380L};

        DataPoint[] rip = new DataPoint[inputData.length];
        for(int i=0; i<rip.length; i++) {
            rip[i] = new DataPoint(inputData[i],(long)inputTimestamp[i]/1000);
        }

        SensorConfiguration sensorConfig = new SensorConfiguration();
        sensorConfig.add("RIP", 64.0 / 3.0, AUTOSENSE.CHEST_RIP);
        PeakValley result = Core.peakvalley_v2(rip, sensorConfig);

        int[] resultValley = new int[result.valleyIndex.size()];
        int[] resultPeak = new int[result.peakIndex.size()];        
        
        for(int i=0; i<resultValley.length; i++) {
            resultValley[i] = result.valleyIndex.get(i);
        }
        for(int i=0; i<resultPeak.length; i++) {
            resultPeak[i] = result.peakIndex.get(i);
        }        
        
        int[] correctValley = new int[] {38,88,121,174,224};
        int[] correctPeak = new int[] {59,106,148,197,257};


        assertArrayEquals(correctValley,resultValley);
        assertArrayEquals(correctPeak,resultPeak);


    }

    @Test
    public void testMac() throws Exception {

    }

    @Test
    public void testInterceptOutlierDetectorRIPLamia() throws Exception {

    }
}